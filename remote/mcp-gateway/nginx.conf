events {
    worker_connections 1024;
}

http {
    server {
        listen 80;
        
        location /health {
            return 200 "OK";
            add_header Content-Type text/plain;
        }
        
        location /mcp {
            proxy_pass https://mcp.posthog.com/mcp;
            proxy_set_header Host mcp.posthog.com;
            proxy_set_header Authorization "Bearer phx_iIF5hADxEPntazhzFRqV8OZibiV4qJdFt16w8nbv6Ty4utq";
            proxy_set_header User-Agent "MCP-Gateway/1.0";
            proxy_set_header Accept "application/json";
            proxy_set_header Content-Type "application/json";
            proxy_set_header X-Forwarded-Proto https;
            
            # CORS headers for Claude Web
            add_header Access-Control-Allow-Origin "*" always;
            add_header Access-Control-Allow-Methods "GET, POST, OPTIONS" always;
            add_header Access-Control-Allow-Headers "Authorization, Content-Type, Accept" always;
            
            if ($request_method = OPTIONS) {
                return 204;
            }
            
            proxy_buffering off;
            proxy_cache off;
            proxy_read_timeout 86400;
        }
        
        location /sse {
            proxy_pass https://mcp.posthog.com/sse;
            proxy_set_header Host mcp.posthog.com;
            proxy_set_header Authorization "Bearer phx_iIF5hADxEPntazhzFRqV8OZibiV4qJdFt16w8nbv6Ty4utq";
            proxy_set_header Accept "text/event-stream";
            proxy_set_header Cache-Control "no-cache";
            
            # SSE specific settings
            proxy_buffering off;
            proxy_cache off;
            proxy_read_timeout 86400;
            chunked_transfer_encoding off;
        }
    }
}
